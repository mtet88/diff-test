name: Diff extract

on:
  pull_request:
    branches: 
      - "main"

jobs:
  build:
    runs-on: ubuntu-latest 
    
    steps:
      # 1. Checkout del código de la pull request
      - name: Checkout code
        uses: actions/checkout@v3
      
      # 2. Obtener la última versión de la rama main
      - name: Fetch main branch
        run: git fetch origin main

      # 3. Encontrar los archivos .strings que han cambiado y generar diffs
      - name: Find changed .strings files and generate diffs
        run: |
          # Crear un directorio para almacenar los archivos diff
          mkdir -p diff_files
          
          # Encontrar todos los archivos .strings que han cambiado en la PR
          for file in $(git diff --name-only origin/main...HEAD -- '*.strings'); do
            # Definir el nombre del archivo de salida diff
            diff_output="diff_files/$(basename $file .strings)_diff.txt"
            
            # Generar el diff y guardarlo en diff_output
            git diff origin/main...HEAD -- $file > $diff_output || true
          done
      
      # 4. Subir los archivos diff como artefacto
      - name: Upload diff files as artifact
        uses: actions/upload-artifact@v3
        with:
          name: strings-diff
          path: diff_files/
